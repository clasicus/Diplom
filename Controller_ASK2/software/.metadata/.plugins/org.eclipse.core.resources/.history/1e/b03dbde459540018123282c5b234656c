/*
 * SETTING.c
 *
 *  Created on: 10.05.2018
 *      Author: ilnitskaya-ll
 */
#include "sys/alt_stdio.h"
#include "alt_types.h"
#include <io.h>
#include "altera_avalon_pio_regs.h"
#include "system.h"
#include "ACK2_main.h"
#include "LCD.h"
#include "resolver.h"
#include "ANGLE_SETTING.h"
alt_16 ANGLE_SETTING(alt_8 k)
{
alt_u32 timer;
timer=0;
alt_16 Angle_norm;
alt_16 resolver_angle;
 if (k==0)
    {
          Angle_norm=0;
          resolver_angle=Resolver_read_position_in_normal_mode();
  //вывести на ЖКИ значение угла
  /* Выводим на ЖКИ-индикатор углы с устройства управления резольверами
    				   * (переведенный из 16-разрядного кода в угол
    				   * (код*100(с двумя знаками после запятой)*360/65535,в первую строчку с 10-ой позиции
    				   * с двумя знаками после запятой   				   */

    				    //temp = PIO_2_ANGLE_BASE*100*360/65535;
    	  LCD_print_digital_number_on_screen (resolver_angle*100*360/65535,9,2);
           k=k+1;
    }
 else
    {
 //задержка 0,5с
	while(timer==500000000)
	{
 	//проверка SW_5" (ждем удержание клавиши)
  	  if (SW5_MASK||IORD_ALTERA_AVALON_PIO_DATA(PIO_KEYBOARD_SW6_SW1_BASE)==0x0)
  	  {
  				  	   Angle_norm++;
  	//вывести на ЖКИ значение угла
  	  /* Выводим на ЖКИ-индикатор углы с устройства управления резольверами
  	    				   * (переведенный из 16-разрядного кода в угол
  	    				   * (код*100(с двумя знаками после запятой)*360/65535,в первую строчку с 10-ой позиции
  	    				   * с двумя знаками после запятой   				   */

  	    				    //temp = PIO_2_ANGLE_BASE*100*360/65535;
  	    	  LCD_print_digital_number_on_screen (resolver_angle*100*360/65535,9,2);
  	    	  timer=0;
  	  }//проверка SW_6" (ждем удержание клавиши)
  	    	  else if (SW6_MASK||IORD_ALTERA_AVALON_PIO_DATA(PIO_KEYBOARD_SW6_SW1_BASE)==0x0)
  	    	  {
  				  		Angle_norm=Angle_norm-1;
  			  LCD_print_digital_number_on_screen (resolver_angle*100*360/65535,9,2);
  		      timer=0;
  	    	  }
  	    	 if (((SW5_MASK||(IORD_ALTERA_AVALON_PIO_DATA(PIO_KEYBOARD_SW6_SW1_BASE)))==0x01)&&((SW6_MASK||IORD_ALTERA_AVALON_PIO_DATA(PIO_KEYBOARD_SW6_SW1_BASE)==0x01)))
  	    			timer=500000000;
  	    			else
  	    				timer=0;
	}
	return (Angle_norm);
    }

